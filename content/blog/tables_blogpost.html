---
output: 
  html_document:
    keep_md: true
    css: mystyles.css
---



<p>One of the neat tools available via a variety of packages in <strong>R</strong> is the creation of beautiful tables using data frames stored in <strong>R</strong>. In what follows, I’ll discuss these different options using data on departing flights from Seattle and Portland in 2014. (More information and the source code for this <strong>R</strong> package is available at <a href="https://github.com/ismayc/pnwflights14" class="uri">https://github.com/ismayc/pnwflights14</a>.)</p>
<p>We begin by ensuring the needed packages are installed and then load them into our <strong>R</strong> session.</p>
<pre class="r"><code># List of packages required for this analysis
pkg &lt;- c(&quot;dplyr&quot;, &quot;knitr&quot;, &quot;devtools&quot;, &quot;DT&quot;, &quot;xtable&quot;)

# Check if packages are not installed and assign the
# names of the packages not installed to the variable new.pkg
new.pkg &lt;- pkg[!(pkg %in% installed.packages())]

# If there are any packages in the list that aren&#39;t installed,
# install them
if (length(new.pkg)) {
  install.packages(new.pkg, repos = &quot;http://cran.rstudio.com&quot;)
}

# Load the packages into R
library(dplyr)
library(knitr)
library(DT)
library(xtable)

# Install Chester&#39;s pnwflights14 package (if not already)
if (!require(pnwflights14)){
  library(devtools)
  devtools::install_github(&quot;ismayc/pnwflights14&quot;)
  }</code></pre>
<pre><code>##   
   checking for file ‘/tmp/RtmpXKJ3QQ/remotes5bdf479a49305/ismayc-pnwflights14-0a122d9/DESCRIPTION’ ...
  
✓  checking for file ‘/tmp/RtmpXKJ3QQ/remotes5bdf479a49305/ismayc-pnwflights14-0a122d9/DESCRIPTION’
## 
  
─  preparing ‘pnwflights14’:
## 
  
   checking DESCRIPTION meta-information ...
  
✓  checking DESCRIPTION meta-information
## 
  
─  checking for LF line-endings in source and make files and shell scripts
## 
  
─  checking for empty or unneeded directories
## ─  looking to see if a ‘data/datalist’ file should be added
## 
  
─  building ‘pnwflights14_0.1.0.9000.tar.gz’ (881ms)
## 
  
   
## </code></pre>
<pre class="r"><code>library(pnwflights14)

# Load the flights dataset
data(&quot;flights&quot;, package = &quot;pnwflights14&quot;)</code></pre>
<p>The dataset provides for the development of a lot of interesting questions. Here I will delve further into some of the questions I addressed in two recent workshops I led in the Fall 2015 Data @ Reed Research Skills Workshop Series. (Slides available at <a href="http://rpubs.com/cismay" class="uri">http://rpubs.com/cismay</a>.)</p>
<p>The questions I will analyze by creating tables are</p>
<ol style="list-style-type: decimal">
<li><p>Which destinations had the worst arrival delays (on average) from the two PNW airports?</p></li>
<li><p>How does the maximum departure delay vary by month for each of the two airports?</p></li>
<li><p>How many flights departed for each airline from each of the airports?</p></li>
</ol>
<div id="the-kable-function-in-the-knitr-package" class="section level4">
<h4>The <code>kable</code> function in the <code>knitr</code> package</h4>
<p>To address the first question, we will use the <code>dplyr</code> package written by Hadley Wickham as below. We’ll use the <code>top_n</code> function to isolate the 5 worst mean arrival delays.</p>
<pre class="r"><code>worst_arr_delays &lt;- flights %&gt;% group_by(dest) %&gt;%
  summarize(mean_arr_delay = mean(arr_delay, na.rm = TRUE)) %&gt;%
  arrange(desc(mean_arr_delay)) %&gt;%
  top_n(n = 5, wt = mean_arr_delay)</code></pre>
<p>This information is helpful but you may not necessarily know to which airport each of these FAA airport codes refers. One of the other data sets included in the <code>pnwflights14</code> package is <code>airports</code> that lists the names. Here we will do a match to identify the names of these airports using the <code>inner_join</code> function in <code>dplyr</code>.</p>
<pre class="r"><code>data(&quot;airports&quot;, package = &quot;pnwflights14&quot;)
joined_worst &lt;- inner_join(worst_arr_delays, airports, by = c(&quot;dest&quot; = &quot;faa&quot;)) %&gt;%
  select(name, dest, mean_arr_delay) %&gt;%
  rename(&quot;Airport Name&quot; = name, &quot;Airport Code&quot; = dest, &quot;Mean Arrival Delay&quot; = mean_arr_delay)</code></pre>
<p>Lastly we output this table cleanly using the <code>kable</code> function.</p>
<pre class="r"><code>kable(joined_worst)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Airport Name</th>
<th align="left">Airport Code</th>
<th align="right">Mean Arrival Delay</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Cleveland Hopkins Intl</td>
<td align="left">CLE</td>
<td align="right">26.150000</td>
</tr>
<tr class="even">
<td align="left">William P Hobby</td>
<td align="left">HOU</td>
<td align="right">10.250000</td>
</tr>
<tr class="odd">
<td align="left">Metropolitan Oakland Intl</td>
<td align="left">OAK</td>
<td align="right">10.067460</td>
</tr>
<tr class="even">
<td align="left">San Francisco Intl</td>
<td align="left">SFO</td>
<td align="right">8.864937</td>
</tr>
<tr class="odd">
<td align="left">Bellingham Intl</td>
<td align="left">BLI</td>
<td align="right">8.673913</td>
</tr>
</tbody>
</table>
<p>Oddly enough, flights to Cleveland (from PDX and SEA) had the worst arrival delays in 2014. Houston also had around a 10 minute delay on average. Surprisingly, the airport in Bellingham, WA (only around 100 miles north of SEA) had the fifth largest mean arrival delay.</p>
</div>
<div id="the-dt-package" class="section level4">
<h4>The DT package</h4>
<p>In order to answer the second question, we’ll again make use of the various functions in the <code>dplyr</code> package.</p>
<pre class="r"><code>dep_delays_by_month &lt;- flights %&gt;% group_by(origin, month) %&gt;%
summarize(max_delay = max(dep_delay, na.rm = TRUE))</code></pre>
<p>The <code>DT</code> package provides a nice interface for viewing data frames in <strong>R</strong>. I’ve specified a few extra options here to show all 12 months by default and to automatically set the width. Go ahead and play around with the filter boxes at the top of each column too. (An excellent tutorial on <code>DT</code> is available at <a href="https://rstudio.github.io/DT/" class="uri">https://rstudio.github.io/DT/</a>.)</p>
<pre class="r"><code>datatable(dep_delays_by_month,
          filter = &#39;top&#39;, options = list(
            pageLength = 12, autoWidth = TRUE
          ))</code></pre>
<p>The created table in HTML is available <a href="http://www.reed.edu/data-at-reed/software/R/blogposts/DT.html">here</a>.</p>
<p>If you click on the <code>max_delay</code> column header, you should see that the maximum departure delay for PDX was in March and for Seattle was in May.</p>
</div>
<div id="the-xtable-package-to-produce-nice-tables-in-a-pdf" class="section level4">
<h4>The <code>xtable</code> package to produce nice tables in a PDF</h4>
<p>Again, we find ourselves using the extremely helpful <code>dplyr</code> package to answer this question and to create the underpinnings of our table to display. We merge the flights data with the <code>airlines</code> data to get the names of the airlines from the two letter carrier code.</p>
<pre class="r"><code>data(&quot;airlines&quot;, package = &quot;pnwflights14&quot;)
by_airline &lt;- flights %&gt;% group_by(origin, carrier) %&gt;%
  summarize(count = n()) %&gt;%
  inner_join(x = ., y = airlines, by = &quot;carrier&quot;) %&gt;%
  arrange(desc(count))</code></pre>
<p>The <code>xtable</code> package and its <code>xtable</code> function (and also the <code>kable</code> function you saw earlier) provide the functionality to generate HTML code or <span class="math inline">\(\LaTeX\)</span> code to produce a table. We will focus on producing the <span class="math inline">\(\LaTeX\)</span> code in this example.</p>
<pre class="r"><code>print(xtable(by_airline),
      comment = FALSE)</code></pre>

<p>If you don’t know <span class="math inline">\(\LaTeX\)</span>, I’ve also duplicated a similar table using <code>kable</code> for you to compare:</p>
<pre class="r"><code>kable(by_airline)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">origin</th>
<th align="left">carrier</th>
<th align="right">count</th>
<th align="left">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">SEA</td>
<td align="left">AS</td>
<td align="right">49616</td>
<td align="left">Alaska Airlines Inc.</td>
</tr>
<tr class="even">
<td align="left">PDX</td>
<td align="left">AS</td>
<td align="right">12844</td>
<td align="left">Alaska Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">SEA</td>
<td align="left">WN</td>
<td align="right">12162</td>
<td align="left">Southwest Airlines Co.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">DL</td>
<td align="right">11548</td>
<td align="left">Delta Air Lines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">WN</td>
<td align="right">11193</td>
<td align="left">Southwest Airlines Co.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">UA</td>
<td align="right">10610</td>
<td align="left">United Air Lines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">OO</td>
<td align="right">9841</td>
<td align="left">SkyWest Airlines Inc.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">OO</td>
<td align="right">8869</td>
<td align="left">SkyWest Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">UA</td>
<td align="right">6061</td>
<td align="left">United Air Lines Inc.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">AA</td>
<td align="right">5399</td>
<td align="left">American Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">DL</td>
<td align="right">5168</td>
<td align="left">Delta Air Lines Inc.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">US</td>
<td align="right">3585</td>
<td align="left">US Airways Inc.</td>
</tr>
<tr class="odd">
<td align="left">SEA</td>
<td align="left">VX</td>
<td align="right">2606</td>
<td align="left">Virgin America</td>
</tr>
<tr class="even">
<td align="left">PDX</td>
<td align="left">US</td>
<td align="right">2361</td>
<td align="left">US Airways Inc.</td>
</tr>
<tr class="odd">
<td align="left">SEA</td>
<td align="left">B6</td>
<td align="right">2253</td>
<td align="left">JetBlue Airways</td>
</tr>
<tr class="even">
<td align="left">PDX</td>
<td align="left">AA</td>
<td align="right">2187</td>
<td align="left">American Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">F9</td>
<td align="right">1362</td>
<td align="left">Frontier Airlines Inc.</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">F9</td>
<td align="right">1336</td>
<td align="left">Frontier Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">B6</td>
<td align="right">1287</td>
<td align="left">JetBlue Airways</td>
</tr>
<tr class="even">
<td align="left">SEA</td>
<td align="left">HA</td>
<td align="right">730</td>
<td align="left">Hawaiian Airlines Inc.</td>
</tr>
<tr class="odd">
<td align="left">PDX</td>
<td align="left">VX</td>
<td align="right">666</td>
<td align="left">Virgin America</td>
</tr>
<tr class="even">
<td align="left">PDX</td>
<td align="left">HA</td>
<td align="right">365</td>
<td align="left">Hawaiian Airlines Inc.</td>
</tr>
</tbody>
</table>
<p>With the originating airport duplicating across all of the airlines, it would be nice if we could reduce this duplication and just bold PDX or SEA and have each appear once. Awesomely enough, the <code>rle</code> function in <strong>R</strong> will be of great help to us in this endeavor. It counts how many times a value is repeated in a table. We will then make a call to the <code>multirow</code> function in <span class="math inline">\(\LaTeX\)</span> in a sneaky way of pasting the appropriate text in addition to using the <code>force</code> option for sanitizing the text into <span class="math inline">\(\LaTeX\)</span>.</p>
<p>We add in a few options to make the output of the table a little nicer by specifying horizontal lines and removing the default rownames.</p>
<pre class="r"><code>rle.lengths &lt;- rle(by_airline$origin)$lengths
first &lt;- !duplicated(by_airline$origin)
by_airline$origin[!first] &lt;- &quot;&quot;
by_airline$origin[first] &lt;- paste(&quot;\\multirow{&quot;, 
                                  rle.lengths,
                                  &quot;}{*}{\\textbf{&quot;,
                                  by_airline$origin[first], &quot;}}&quot;)</code></pre>
<pre><code>## Warning in by_airline$origin[first] &lt;- paste(&quot;\\multirow{&quot;, rle.lengths, :
## number of items to replace is not a multiple of replacement length</code></pre>
<pre class="r"><code>print(xtable(by_airline),
              comment = FALSE,
              hline.after=c(-1,0,nrow(by_airline), 11),
              sanitize.text.function = force,
              include.rownames = FALSE)</code></pre>
<p>The resulting table produced by <span class="math inline">\(\LaTeX\)</span> can be found at Overleaf.com at <a href="https://www.overleaf.com/read/wvrpxpwrbvnk" class="uri">https://www.overleaf.com/read/wvrpxpwrbvnk</a>.</p>
<p>We see that Alaska Airlines had the most flights out of both airports with Southwest coming in second at both airports.</p>
<p>(The generating R Markdown file for this HTML document—saved in the .Rmd extension—is available <a href="http://reed.edu/data-at-reed/software/R/blogposts/tables_blogpost.Rmd">here</a>.)</p>
</div>
